{"version":3,"sources":["CreateGraphPath.ts"],"names":["PIXEL_RATIO","getGraphPathRange","points","range","minValueX","x","min","date","Date","maxValueX","max","length","minValueY","y","reduce","prev","curr","value","Number","MAX_SAFE_INTEGER","maxValueY","MIN_SAFE_INTEGER","getXPositionInRange","xRange","diff","getTime","getXInRange","width","Math","floor","getYPositionInRange","yRange","getYInRange","height","getPointsInRange","allPoints","filter","point","portionFactorX","createGraphPathBase","pointsInRange","graphData","horizontalPadding","verticalPadding","canvasHeight","canvasWidth","shouldFillGradient","path","Skia","Path","Make","drawingWidth","drawingHeight","startX","endX","getGraphDataIndex","pixel","round","getNextPixelValue","index","exactPointX","isExactPointInsidePixelRatio","Array","fill","some","_value","additionalPixel","push","i","moveTo","prevPrev","p0","p1","cp1x","cp1y","cp2x","cp2y","cp3x","cp3y","cubicTo","gradientPath","copy","lineTo","createGraphPath","props","createGraphPathWithGradient"],"mappings":"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","sourcesContent":["import { SkPath, Skia, SkPoint } from '@shopify/react-native-skia'\nimport type { GraphPoint, GraphRange } from './LineGraphProps'\n\nconst PIXEL_RATIO = 2\n\nexport interface GraphXRange {\n  min: Date\n  max: Date\n}\n\nexport interface GraphYRange {\n  min: number\n  max: number\n}\n\nexport interface GraphPathRange {\n  x: GraphXRange\n  y: GraphYRange\n}\n\ntype GraphPathConfig = {\n  /**\n   * Graph Points to use for the Path. Will be normalized and centered.\n   */\n  pointsInRange: GraphPoint[]\n  /**\n   * Optional Padding (left, right) for the Graph to correctly round the Path.\n   */\n  horizontalPadding: number\n  /**\n   * Optional Padding (top, bottom) for the Graph to correctly round the Path.\n   */\n  verticalPadding: number\n  /**\n   * Height of the Canvas (Measured with onLayout)\n   */\n  canvasHeight: number\n  /**\n   * Width of the Canvas (Measured with onLayout)\n   */\n  canvasWidth: number\n  /**\n   * Range of the graph's x and y-axis\n   */\n  range: GraphPathRange\n}\n\ntype GraphPathConfigWithGradient = GraphPathConfig & {\n  shouldFillGradient: true\n}\ntype GraphPathConfigWithoutGradient = GraphPathConfig & {\n  shouldFillGradient: false\n}\n\nexport function getGraphPathRange(\n  points: GraphPoint[],\n  range?: GraphRange\n): GraphPathRange {\n  const minValueX = range?.x?.min ?? points[0]?.date ?? new Date()\n  const maxValueX =\n    range?.x?.max ?? points[points.length - 1]?.date ?? new Date()\n\n  const minValueY =\n    range?.y?.min ??\n    points.reduce(\n      (prev, curr) => (curr.value < prev ? curr.value : prev),\n      Number.MAX_SAFE_INTEGER\n    )\n  const maxValueY =\n    range?.y?.max ??\n    points.reduce(\n      (prev, curr) => (curr.value > prev ? curr.value : prev),\n      Number.MIN_SAFE_INTEGER\n    )\n\n  return {\n    x: { min: minValueX, max: maxValueX },\n    y: { min: minValueY, max: maxValueY },\n  }\n}\n\nexport const getXPositionInRange = (\n  date: Date,\n  xRange: GraphXRange\n): number => {\n  const diff = xRange.max.getTime() - xRange.min.getTime()\n  const x = date.getTime()\n\n  return (x - xRange.min.getTime()) / diff\n}\n\nexport const getXInRange = (\n  width: number,\n  date: Date,\n  xRange: GraphXRange\n): number => {\n  return Math.floor(width * getXPositionInRange(date, xRange))\n}\n\nexport const getYPositionInRange = (\n  value: number,\n  yRange: GraphYRange\n): number => {\n  const diff = yRange.max - yRange.min\n  const y = value\n\n  return (y - yRange.min) / diff\n}\n\nexport const getYInRange = (\n  height: number,\n  value: number,\n  yRange: GraphYRange\n): number => {\n  return Math.floor(height * getYPositionInRange(value, yRange))\n}\n\nexport const getPointsInRange = (\n  allPoints: GraphPoint[],\n  range: GraphPathRange\n) => {\n  return allPoints.filter((point) => {\n    const portionFactorX = getXPositionInRange(point.date, range.x)\n    return portionFactorX <= 1 && portionFactorX >= 0\n  })\n}\n\ntype GraphPathWithGradient = { path: SkPath; gradientPath: SkPath }\n\nfunction createGraphPathBase(\n  props: GraphPathConfigWithGradient\n): GraphPathWithGradient\nfunction createGraphPathBase(props: GraphPathConfigWithoutGradient): SkPath\n\nfunction createGraphPathBase({\n  pointsInRange: graphData,\n  range,\n  horizontalPadding,\n  verticalPadding,\n  canvasHeight: height,\n  canvasWidth: width,\n  shouldFillGradient,\n}: GraphPathConfigWithGradient | GraphPathConfigWithoutGradient):\n  | SkPath\n  | GraphPathWithGradient {\n  const path = Skia.Path.Make()\n\n  // Canvas width substracted by the horizontal padding => Actual drawing width\n  const drawingWidth = width - 2 * horizontalPadding\n  // Canvas height substracted by the vertical padding => Actual drawing height\n  const drawingHeight = height - 2 * verticalPadding\n\n  if (graphData[0] == null) return path\n\n  const points: SkPoint[] = []\n\n  const startX =\n    getXInRange(drawingWidth, graphData[0]!.date, range.x) + horizontalPadding\n  const endX =\n    getXInRange(drawingWidth, graphData[graphData.length - 1]!.date, range.x) +\n    horizontalPadding\n\n  const getGraphDataIndex = (pixel: number) =>\n    Math.round(((pixel - startX) / (endX - startX)) * (graphData.length - 1))\n\n  const getNextPixelValue = (pixel: number) => {\n    if (pixel === endX || pixel + PIXEL_RATIO < endX) return pixel + PIXEL_RATIO\n    return endX\n  }\n\n  for (\n    let pixel = startX;\n    startX <= pixel && pixel <= endX;\n    pixel = getNextPixelValue(pixel)\n  ) {\n    const index = getGraphDataIndex(pixel)\n\n    // Draw first point only on the very first pixel\n    if (index === 0 && pixel !== startX) continue\n    // Draw last point only on the very last pixel\n\n    if (index === graphData.length - 1 && pixel !== endX) continue\n\n    if (index !== 0 && index !== graphData.length - 1) {\n      // Only draw point, when the point is exact\n      const exactPointX =\n        getXInRange(drawingWidth, graphData[index]!.date, range.x) +\n        horizontalPadding\n\n      const isExactPointInsidePixelRatio = Array(PIXEL_RATIO)\n        .fill(0)\n        .some((_value, additionalPixel) => {\n          return pixel + additionalPixel === exactPointX\n        })\n\n      if (!isExactPointInsidePixelRatio) continue\n    }\n\n    const value = graphData[index]!.value\n    const y =\n      drawingHeight -\n      getYInRange(drawingHeight, value, range.y) +\n      verticalPadding\n\n    points.push({ x: pixel, y: y })\n  }\n\n  for (let i = 0; i < points.length; i++) {\n    const point = points[i]!\n\n    // first point needs to start the path\n    if (i === 0) path.moveTo(point.x, point.y)\n\n    const prev = points[i - 1]\n    const prevPrev = points[i - 2]\n\n    if (prev == null) continue\n\n    const p0 = prevPrev ?? prev\n    const p1 = prev\n    const cp1x = (2 * p0.x + p1.x) / 3\n    const cp1y = (2 * p0.y + p1.y) / 3\n    const cp2x = (p0.x + 2 * p1.x) / 3\n    const cp2y = (p0.y + 2 * p1.y) / 3\n    const cp3x = (p0.x + 4 * p1.x + point.x) / 6\n    const cp3y = (p0.y + 4 * p1.y + point.y) / 6\n\n    path.cubicTo(cp1x, cp1y, cp2x, cp2y, cp3x, cp3y)\n\n    if (i === points.length - 1) {\n      path.cubicTo(point.x, point.y, point.x, point.y, point.x, point.y)\n    }\n  }\n\n  if (!shouldFillGradient) return path\n\n  const gradientPath = path.copy()\n\n  gradientPath.lineTo(endX, height + verticalPadding)\n  gradientPath.lineTo(0 + horizontalPadding, height + verticalPadding)\n\n  return { path: path, gradientPath: gradientPath }\n}\n\nexport function createGraphPath(props: GraphPathConfig): SkPath {\n  return createGraphPathBase({ ...props, shouldFillGradient: false })\n}\n\nexport function createGraphPathWithGradient(\n  props: GraphPathConfig\n): GraphPathWithGradient {\n  return createGraphPathBase({\n    ...props,\n    shouldFillGradient: true,\n  })\n}\n"]}